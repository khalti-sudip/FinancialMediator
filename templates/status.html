<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Status - Banking Middleware API</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/custom.css') }}">
    <style>
        body {
            padding: 20px;
        }
        .status-card {
            margin-bottom: 20px;
        }
        .status-up {
            color: #28a745;
        }
        .status-down {
            color: #dc3545;
        }
        .status-degraded {
            color: #ffc107;
        }
    </style>
</head>
<body>
    <div class="container py-4">
        <header class="pb-3 mb-4 border-bottom">
            <div class="d-flex align-items-center justify-content-between">
                <a href="/" class="d-flex align-items-center text-body-emphasis text-decoration-none">
                    <span class="fs-4">Banking Middleware API</span>
                </a>
                <a href="/" class="btn btn-outline-secondary">Back to Home</a>
            </div>
        </header>

        <div class="row mb-4">
            <div class="col-md-12">
                <div class="p-4 bg-body-tertiary rounded-3">
                    <h2 class="display-6 fw-bold mb-4">System Status Dashboard</h2>
                    <div id="system-status-overview" class="mb-4">
                        <div class="d-flex align-items-center">
                            <span id="overall-status-indicator" class="health-indicator healthy me-2"></span>
                            <span id="overall-status-text" class="fs-5 fw-bold">All Systems Operational</span>
                        </div>
                        <p class="text-muted mt-2">Last updated: <span id="last-updated-time">Loading...</span></p>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-md-6">
                <div class="dashboard-panel">
                    <div class="dashboard-panel-header">
                        <h3>Core Services</h3>
                    </div>
                    <div class="list-group">
                        <div class="list-group-item bg-transparent border-0">
                            <div class="d-flex w-100 justify-content-between align-items-center">
                                <div>
                                    <span class="health-indicator healthy me-2"></span>
                                    <span class="fw-bold">API Gateway</span>
                                </div>
                                <span class="status-badge status-completed">Online</span>
                            </div>
                        </div>
                        <div class="list-group-item bg-transparent border-0">
                            <div class="d-flex w-100 justify-content-between align-items-center">
                                <div>
                                    <span class="health-indicator healthy me-2"></span>
                                    <span class="fw-bold">Authentication Service</span>
                                </div>
                                <span class="status-badge status-completed">Online</span>
                            </div>
                        </div>
                        <div class="list-group-item bg-transparent border-0">
                            <div class="d-flex w-100 justify-content-between align-items-center">
                                <div>
                                    <span class="health-indicator healthy me-2"></span>
                                    <span class="fw-bold">Transaction Processor</span>
                                </div>
                                <span class="status-badge status-completed">Online</span>
                            </div>
                        </div>
                        <div class="list-group-item bg-transparent border-0">
                            <div class="d-flex w-100 justify-content-between align-items-center">
                                <div>
                                    <span class="health-indicator healthy me-2"></span>
                                    <span class="fw-bold">Data Transformation Engine</span>
                                </div>
                                <span class="status-badge status-completed">Online</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="dashboard-panel">
                    <div class="dashboard-panel-header">
                        <h3>Infrastructure</h3>
                    </div>
                    <div class="list-group">
                        <div class="list-group-item bg-transparent border-0">
                            <div class="d-flex w-100 justify-content-between align-items-center">
                                <div>
                                    <span class="health-indicator healthy me-2"></span>
                                    <span class="fw-bold">Database</span>
                                </div>
                                <span class="status-badge status-completed">Online</span>
                            </div>
                        </div>
                        <div class="list-group-item bg-transparent border-0">
                            <div class="d-flex w-100 justify-content-between align-items-center">
                                <div>
                                    <span class="health-indicator healthy me-2"></span>
                                    <span class="fw-bold">Caching Service</span>
                                </div>
                                <span class="status-badge status-completed">Online</span>
                            </div>
                        </div>
                        <div class="list-group-item bg-transparent border-0">
                            <div class="d-flex w-100 justify-content-between align-items-center">
                                <div>
                                    <span class="health-indicator healthy me-2"></span>
                                    <span class="fw-bold">Logging System</span>
                                </div>
                                <span class="status-badge status-completed">Online</span>
                            </div>
                        </div>
                        <div class="list-group-item bg-transparent border-0">
                            <div class="d-flex w-100 justify-content-between align-items-center">
                                <div>
                                    <span class="health-indicator healthy me-2"></span>
                                    <span class="fw-bold">Security Layer</span>
                                </div>
                                <span class="status-badge status-completed">Online</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-md-12">
                <div class="dashboard-panel">
                    <div class="dashboard-panel-header">
                        <h3>External Services Connection Status</h3>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-dark table-hover">
                            <thead>
                                <tr>
                                    <th>System Name</th>
                                    <th>Type</th>
                                    <th>Status</th>
                                    <th>Last Connection</th>
                                    <th>Response Time</th>
                                </tr>
                            </thead>
                            <tbody id="external-systems-table">
                                <tr>
                                    <td colspan="5" class="text-center">Loading external system data...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-md-6">
                <div class="dashboard-panel">
                    <div class="dashboard-panel-header">
                        <h3>Transaction Summary</h3>
                    </div>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <div class="card bg-dark text-white">
                                <div class="card-body text-center">
                                    <h5 class="card-title">Total</h5>
                                    <p class="card-text fs-2 fw-bold" id="total-transactions">-</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="card bg-success text-white">
                                <div class="card-body text-center">
                                    <h5 class="card-title">Completed</h5>
                                    <p class="card-text fs-2 fw-bold" id="completed-transactions">-</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="card bg-danger text-white">
                                <div class="card-body text-center">
                                    <h5 class="card-title">Failed</h5>
                                    <p class="card-text fs-2 fw-bold" id="failed-transactions">-</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="dashboard-panel">
                    <div class="dashboard-panel-header">
                        <h3>API Health Metrics</h3>
                    </div>
                    <div class="list-group">
                        <div class="list-group-item bg-transparent border-0">
                            <div class="d-flex w-100 justify-content-between align-items-center">
                                <span class="fw-bold">Average Response Time</span>
                                <span>156 ms</span>
                            </div>
                        </div>
                        <div class="list-group-item bg-transparent border-0">
                            <div class="d-flex w-100 justify-content-between align-items-center">
                                <span class="fw-bold">Uptime (24h)</span>
                                <span>99.98%</span>
                            </div>
                        </div>
                        <div class="list-group-item bg-transparent border-0">
                            <div class="d-flex w-100 justify-content-between align-items-center">
                                <span class="fw-bold">Current Load</span>
                                <span>23%</span>
                            </div>
                        </div>
                        <div class="list-group-item bg-transparent border-0">
                            <div class="d-flex w-100 justify-content-between align-items-center">
                                <span class="fw-bold">Error Rate (1h)</span>
                                <span>0.03%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-md-12">
                <div class="dashboard-panel">
                    <div class="dashboard-panel-header d-flex justify-content-between align-items-center">
                        <h3>Recent Transactions</h3>
                        <a href="#" class="btn btn-sm btn-outline-secondary" id="refresh-transactions">Refresh</a>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-dark table-hover">
                            <thead>
                                <tr>
                                    <th>Transaction ID</th>
                                    <th>Type</th>
                                    <th>Source</th>
                                    <th>Target</th>
                                    <th>Status</th>
                                    <th>Time</th>
                                </tr>
                            </thead>
                            <tbody id="recent-transactions-table">
                                <tr>
                                    <td colspan="6" class="text-center">Loading transaction data...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <footer class="pt-3 mt-4 text-body-secondary border-top">
            <div class="d-flex justify-content-between align-items-center">
                <div>Banking Middleware API &copy; 2023</div>
                <div>
                    <button id="refresh-all-stats" class="btn btn-primary">Refresh All Statistics</button>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // Format datetime
        function formatDatetime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString();
        }

        // Update last updated time
        function updateLastUpdatedTime() {
            document.getElementById('last-updated-time').textContent = new Date().toLocaleString();
        }

        // Fetch transaction statistics
        function fetchTransactionStats() {
            // In a real implementation, this would fetch actual transaction statistics
            // We'll simulate the API call for demonstration purposes
            fetch('/api/v1/middleware/health')
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'healthy') {
                        // Update mock transaction counts
                        document.getElementById('total-transactions').textContent = '1,245';
                        document.getElementById('completed-transactions').textContent = '1,198';
                        document.getElementById('failed-transactions').textContent = '47';
                    }
                })
                .catch(error => {
                    console.error('Error fetching transaction stats:', error);
                });
        }

        // Fetch external systems status
        function fetchExternalSystems() {
            // In a real implementation, this would fetch actual system configs and status
            // For now, we'll use static data for demonstration
            const systemsTableBody = document.getElementById('external-systems-table');
            systemsTableBody.innerHTML = '';
            
            const systems = [
                { name: 'Financial Provider A', type: 'financial_provider', status: 'online', lastConnection: new Date().toLocaleString(), responseTime: '89 ms' },
                { name: 'Banking System X', type: 'banking_system', status: 'online', lastConnection: new Date().toLocaleString(), responseTime: '102 ms' },
                { name: 'Credit Service B', type: 'financial_provider', status: 'online', lastConnection: new Date().toLocaleString(), responseTime: '134 ms' },
                { name: 'Core Banking Y', type: 'banking_system', status: 'online', lastConnection: new Date().toLocaleString(), responseTime: '76 ms' }
            ];
            
            systems.forEach(system => {
                const row = document.createElement('tr');
                
                const nameCell = document.createElement('td');
                nameCell.textContent = system.name;
                
                const typeCell = document.createElement('td');
                typeCell.textContent = system.type.replace('_', ' ');
                
                const statusCell = document.createElement('td');
                const statusBadge = document.createElement('span');
                statusBadge.className = 'status-badge status-completed';
                statusBadge.textContent = system.status.charAt(0).toUpperCase() + system.status.slice(1);
                statusCell.appendChild(statusBadge);
                
                const lastConnectionCell = document.createElement('td');
                lastConnectionCell.textContent = system.lastConnection;
                
                const responseTimeCell = document.createElement('td');
                responseTimeCell.textContent = system.responseTime;
                
                row.appendChild(nameCell);
                row.appendChild(typeCell);
                row.appendChild(statusCell);
                row.appendChild(lastConnectionCell);
                row.appendChild(responseTimeCell);
                
                systemsTableBody.appendChild(row);
            });
        }

        // Fetch recent transactions
        function fetchRecentTransactions() {
            // In a real implementation, this would fetch actual transaction data
            // For now, we'll use static data for demonstration
            const transactionsTableBody = document.getElementById('recent-transactions-table');
            transactionsTableBody.innerHTML = '';
            
            const transactions = [
                { id: 'tx-12345abc', type: 'payment', source: 'Banking System X', target: 'Financial Provider A', status: 'completed', time: new Date(Date.now() - 5 * 60000).toLocaleString() },
                { id: 'tx-67890def', type: 'balance', source: 'Banking System X', target: 'Core Banking Y', status: 'completed', time: new Date(Date.now() - 12 * 60000).toLocaleString() },
                { id: 'tx-24680ghi', type: 'transfer', source: 'Credit Service B', target: 'Banking System X', status: 'failed', time: new Date(Date.now() - 25 * 60000).toLocaleString() },
                { id: 'tx-13579jkl', type: 'payment', source: 'Banking System X', target: 'Financial Provider A', status: 'completed', time: new Date(Date.now() - 38 * 60000).toLocaleString() },
                { id: 'tx-97531mno', type: 'account_info', source: 'Core Banking Y', target: 'Banking System X', status: 'completed', time: new Date(Date.now() - 52 * 60000).toLocaleString() }
            ];
            
            transactions.forEach(tx => {
                const row = document.createElement('tr');
                
                const idCell = document.createElement('td');
                idCell.textContent = tx.id;
                
                const typeCell = document.createElement('td');
                typeCell.textContent = tx.type;
                
                const sourceCell = document.createElement('td');
                sourceCell.textContent = tx.source;
                
                const targetCell = document.createElement('td');
                targetCell.textContent = tx.target;
                
                const statusCell = document.createElement('td');
                const statusBadge = document.createElement('span');
                statusBadge.className = `status-badge status-${tx.status}`;
                statusBadge.textContent = tx.status.charAt(0).toUpperCase() + tx.status.slice(1);
                statusCell.appendChild(statusBadge);
                
                const timeCell = document.createElement('td');
                timeCell.textContent = tx.time;
                
                row.appendChild(idCell);
                row.appendChild(typeCell);
                row.appendChild(sourceCell);
                row.appendChild(targetCell);
                row.appendChild(statusCell);
                row.appendChild(timeCell);
                
                transactionsTableBody.appendChild(row);
            });
        }

        // Initialize page
        function initPage() {
            updateLastUpdatedTime();
            fetchTransactionStats();
            fetchExternalSystems();
            fetchRecentTransactions();
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', initPage);
        
        document.getElementById('refresh-transactions').addEventListener('click', function(e) {
            e.preventDefault();
            fetchRecentTransactions();
            updateLastUpdatedTime();
        });
        
        document.getElementById('refresh-all-stats').addEventListener('click', function() {
            initPage();
        });

        // Set up polling for health check (every 30 seconds)
        setInterval(function() {
            fetch('/api/v1/middleware/health')
                .then(response => response.json())
                .then(data => {
                    const statusIndicator = document.getElementById('overall-status-indicator');
                    const statusText = document.getElementById('overall-status-text');
                    
                    if (data.status === 'healthy') {
                        statusIndicator.className = 'health-indicator healthy me-2';
                        statusText.textContent = 'All Systems Operational';
                        statusText.className = 'fs-5 fw-bold';
                    } else {
                        statusIndicator.className = 'health-indicator error me-2';
                        statusText.textContent = 'System Issues Detected';
                        statusText.className = 'fs-5 fw-bold text-danger';
                    }
                    
                    updateLastUpdatedTime();
                })
                .catch(error => {
                    console.error('Error:', error);
                    const statusIndicator = document.getElementById('overall-status-indicator');
                    const statusText = document.getElementById('overall-status-text');
                    
                    statusIndicator.className = 'health-indicator error me-2';
                    statusText.textContent = 'Connection Error';
                    statusText.className = 'fs-5 fw-bold text-danger';
                });
        }, 30000);
    </script>
</body>
</html>
